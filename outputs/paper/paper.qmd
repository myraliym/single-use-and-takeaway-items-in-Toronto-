---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Myra Li
thanks: "Code and data are available at: LINK."
date: "`r Sys.time()`"
date-format: "D MMMM YYYY"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
#bibliography: references.bib
---


# Introduction



# Data {#sec-data}

## Data Source and Collection
## Data Cleaning
## Data Visualization
```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.width=6.5, fig.height=2.8) 
# loading in relevant libraries
library(tidyverse)
library(dplyr, warn.conflicts = FALSE)
library(tidyr)
library(haven)
library(ggplot2)
library(nnet)
library(readr)
library(knitr)
library(kableExtra)

### Input data ###
hot_to_go <- read.csv(here::here("outputs/data/Fig1_hot_to_go.csv"))
raw_data <- read.csv(here::here("outputs/data/cleaned_data.csv"))

```



```{r}
Fhot_to_go <- 
  ggplot(data = hot_to_go, aes(x = Hot_To_Go_Cups, y = Percentage, fill = as.factor(Year))) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(x = "Disposable Hot To-Go Cups, such as coffee cups", y = "Percentage (%)", title = "Usage Patterns of Disposable Hot To-Go Cups in 2018 and 2019") +
  scale_fill_manual(values = c("steelblue", "darkorange"), name = "Year", labels = c("2018", "2019"))

Fhot_to_go
```
```{r}

```

```{r}

```

```{r}

```


```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

# Model
Our final logistic regression model is as follows:
$$log(\frac{\hat{p}_i}{\hat{p}_{ref}}) = \beta_{i0} + \beta_{i1}x_{age} + \beta_{i2}x_{gender} + \beta_{i3}x_{education} + \beta_{i4}x_{household_income}+ \beta_{i5}x_{location}$$
The multinomial logistic regression model estimates the probability of a person's opinion on a by-request/ask-first bylaw aimed at reducing single-use eating utensil consumption in the City of Toronto. The possible opinions include: Strongly Support, Somewhat Support, Neither Support nor Oppose, Somewhat Oppose, Strongly Oppose, and Don't Know. The model takes into account the following 5 predictor variables:
                              
1) Age is a continuous numeric variable representing the individual's age.
                                        
2) Gender is a binary variable (female/male) indicating a person's gender.
                                                
3) Education is a categorical variable representing the highest level of education a respondent had at the time of taking the survey. Categories include Graduated from college/CEGEP/Trade School, Graduated high school, Primary school or less, Some college/CEGEP/Trade School, Some high school, Some university but did not finish, University graduate degree, and University undergraduate degree.
                                               
4) Household income is a categorical variable indicating the respondent's household income range. Categories encompass different income ranges and a "Prefer not to answer" option.
                                                     
5) Location is a categorical variable representing the respondent's location within the City of Toronto. Categories include Toronto, East York, Etobicoke, North York, Scarborough, and York.

# Results

```{r}
#| message: false
#| warning: false
#| echo: false
#| tbl-cap: "Number and Proportion of people opinion on a by-request / ask first bylaw to reduce the use of single-use eating utensils in the City of Toronto"
#| label: tbl-number

# generate count and percentage
result_table <- raw_data %>%
  group_by(`single_use_utensil_bylaw_opinion`) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  as.data.frame()

# change the value "Don?t know" to "Don't know"
result_table$single_use_utensil_bylaw_opinion <- ifelse(result_table$single_use_utensil_bylaw_opinion == "Don?t know", "Don't know", result_table$single_use_utensil_bylaw_opinion)

# print the table
kable(result_table)
```
(@tbl-number) presented summarizes the choices made by respondents regarding single-use takeaway items. The results indicate that 47.6% of respondents showed strong support for a by-request/ask-first bylaw to reduce the use of single-use eating utensils in the City of Toronto. Additionally, 27.9% of respondents somewhat supported the bylaw, while 11.4% of them neither supported nor opposed it. However, 6.2% of respondents somewhat opposed the bylaw, and 4.5% strongly opposed it. These findings suggest that while there is a significant level of support for the bylaw, there are still some concerns or reservations that need to be addressed.

Overall, the analysis suggests that there is mixed support for the single-use utensil bylaw, with a slight majority of respondents showing strong support for it. It is interesting to note that a significant percentage of respondents are still on the fence, as they neither support nor oppose the bylaw. This could indicate a lack of awareness or understanding of the issues surrounding single-use utensils and their impact on the environment.

```{r}
# Create the multinomial logistic regression model
model1 <- multinom(single_use_utensil_bylaw_opinion ~ age + gender + education + household_income + location, data = raw_data)

# Extract the coefficients and standard errors from the model
coefs <- coef(summary(model1))

# Calculate exponentiated coefficients and confidence intervals
coefs_exp <- exp(coefs)
conf_int <- confint(model1)
conf_int_exp <- exp(conf_int)

# Combine exponentiated coefficients and confidence intervals
coefs_ci_exp <- cbind(coefs_exp, conf_int_exp)
coefs_df_exp <- as.data.frame(coefs_ci_exp)
coefs_df_exp$variable <- rownames(coefs_df_exp)

# Melt the data frame to a long format
coefs_melted_exp <- reshape2::melt(coefs_df_exp, id.vars = "variable")
colnames(coefs_melted_exp) <- c("variable", "type", "value")

# Filter only the exponentiated estimates and lower/upper bounds
coefs_melted_filtered_exp <- coefs_melted_exp[coefs_melted_exp$type %in% c("Estimate", "2.5 %", "97.5 %"),]



```

```{r}

```

```{r}

```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In  we implement a posterior predictive check. This shows...

In  we compare the posterior with the prior. This shows... 

```{r}

```

## Diagnostics

is a trace plot. It shows... This suggests...

is a Rhat plot. It shows... This suggests...

```{r}

```



\newpage


# References

