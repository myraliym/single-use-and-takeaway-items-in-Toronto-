---
title: " "
author: "Myra Li"
date: "19 April 2023"
date-format: long
abstract: ""
format: pdf
documentclass: article
geometry: margin = 1in 
bibliography: references.bib
---


# Introduction
Plastics have been recognized as a substantial issue affecting the marine environment since the 1970s [@PlasticParticles], with their pervasive presence causing significant harm to ecosystems and wildlife. Despite growing awareness, many individuals remain uninformed about the severity of this problem, leading to continued dependence on single-use plastic products, which exacerbate pollution and its detrimental effects on our planet. The overuse of plastics contributes to issues such as the accumulation of microplastics, the entanglement and ingestion of plastic debris by marine life, and the leaching of hazardous chemicals into the environment, all of which have lasting consequences for biodiversity and human health.
                           
Given the urgency of addressing the plastic pollution crisis, it is essential to assess public opinions on reducing single-use plastic products and understand how demographic factors may influence these perspectives. To accomplish this, Solid Waste Management Services conducted an online survey to collect input from a diverse range of people. The information gathered will be crucial in informing policy decisions and shaping public education initiatives aimed at curbing plastic consumption.
                                
In this report, we employ a logistic regression model to elucidate the relationship between demographic factors and an individual's stance on a by-request/ask-first bylaw, which aims to reduce single-use eating utensil consumption in the City of Toronto. By analyzing these factors, we can better understand public receptiveness to such a bylaw and develop targeted strategies to raise awareness and foster behavioral changes that ultimately contribute to mitigating the adverse effects of plastic pollution on our environment.

We obtained the dataset from OpenDataToronto [@citeODT]. This analysis will be performed in R [@R], using the tidyverse @R-tidyverse, dplyr [@dplyr], tidyr [@R-tidyr], haven [@haven], readr [@R-readr], knitr [@R-knitr]. All tables in the report are generated by , and kableExtra [@R-kableExtra]. All figures in the report are generated using ggplot2 [@ggplot].And we used modelsummary [@R-modelsummary], nnet [@R-nnet] for the model analyzing.

# Data {#sec-data}

## Data Source and Collection
## Data Cleaning
## Data Visualization

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(fig.width=6.5, fig.height=2.8) 
# loading in relevant libraries
library(opendatatoronto)
library(tidyverse)
library(dplyr, warn.conflicts = FALSE)
library(tidyr)
library(haven)
library(ggplot2)
library(nnet)
library(readr)
library(knitr)
library(kableExtra)
library(modelsummary)        

### Input data ###
raw_data <- read.csv(here::here("outputs/data/cleaned_data.csv"))

```

```{r}
# Subset the data frame to include only the necessary columns
gender <- subset(raw_data, select = c("single_use_utensil_bylaw_opinion", "gender"))

# Define the order of the opinion categories
opinion_order <- c("Strongly support", "Somewhat support", "Neither support nor oppose", 
                   "Somewhat oppose", "Strongly oppose", "Don't know")

# Convert the opinion column to a factor with the desired order
gender$single_use_utensil_bylaw_opinion <- factor(gender$single_use_utensil_bylaw_opinion, levels = opinion_order)

# Generate a bar plot with gender on the x axis and count on the y axis
ggplot(gender, aes(x = single_use_utensil_bylaw_opinion, fill = gender)) +
  geom_bar(position = position_dodge()) +
  labs(title = "Opinions on Single-Use Utensil Bylaw by Gender", 
       x = "Opinion", y = "Count") +
  scale_fill_manual(values = c("#E69F00", "#56B4E9"), labels = c("Male", "Female")) 

```
```{r}

# Subset the data frame to include only the necessary columns
age <- subset(raw_data, select = c("single_use_utensil_bylaw_opinion", "age"))

# Define the order of the opinion categories
opinion_order <- c("Strongly support", "Somewhat support", "Neither support nor oppose", 
                   "Somewhat oppose", "Strongly oppose", "Don't know")

# Convert the opinion column to a factor with the desired order
age$single_use_utensil_bylaw_opinion <- factor(age$single_use_utensil_bylaw_opinion, levels = opinion_order)

# Generate a line graph with age on the x axis and count on the y axis, colored by opinion
ggplot(age, aes(x = age, y = ..count.., group = single_use_utensil_bylaw_opinion, color = single_use_utensil_bylaw_opinion)) +
  geom_line(stat = "bin", bins = 10) +
  labs(title = "Opinions on Single-Use Utensil Bylaw by Age", 
       x = "Age", y = "Count", color = "Opinion") +
  scale_color_manual(values = c("#F8766D", "#00BFC4", "#7CAE00", "#E69F00", "#0072B2", "#D8C400")) 

```

```{r}
library(ggplot2)

# Subset the data frame to include only the necessary columns
df <- subset(raw_data, select = c("single_use_utensil_bylaw_opinion", "education"))

# Define the order of the education levels
edu_levels <- c("Primary school or less", "Some high school", "Graduated high school", 
                 "Some college / CEGEP / Trade School", "Graduated from college / CEGEP / Trade School", 
                 "Some university, but did not finish", "University undergraduate degree", "University graduate degree")

# Define the order of the opinions
opinions <- c("Strongly support", "Somewhat support", "Neither support nor oppose", 
              "Somewhat oppose", "Strongly oppose", "Don't know")

# Generate a list of ggplot objects, one for each opinion
plots <- lapply(opinions, function(opinion) {
  # Filter the data frame for the current opinion
  df_opinion <- df %>% filter(single_use_utensil_bylaw_opinion == opinion)
  
  # Calculate the count of each education level for the current opinion
  counts <- df_opinion %>% 
    group_by(education) %>% 
    summarise(count = n())
  
  # Generate the grouped bar chart
  ggplot(counts, aes(x = education, y = count, fill = education)) +
    geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
    labs(title = paste("Opinions on Single-Use Utensil Bylaw:", opinion), 
         x = "Education Level", y = "Count", fill = "Education") +
    scale_fill_manual(values = c("#F0E442", "#0072B2", "#D55E00", "#009E73", "#F8766D", "#00BFC4", "#7CAE00", "#C77CFF"),
                      labels = edu_levels) +
    guides(fill=guide_legend(reverse=TRUE)) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
})

# Print the list of ggplot objects using grid.arrange
gridExtra::grid.arrange(grobs = plots, ncol = 2)

```

# Model
Our final logistic regression model is as follows:
$$log(\frac{\hat{p}_i}{\hat{p}_{ref}}) = \beta_{i0} + \beta_{i1}x_{gender} + \beta_{i2}x_{age} + \beta_{i3}x_{education} + \beta_{i4}x_{household_income}+ \beta_{i5}x_{location}$$
The multinomial logistic regression model estimates the probability of a person's opinion on a by-request/ask-first bylaw aimed at reducing single-use eating utensil consumption in the City of Toronto. The possible opinions include: Strongly Support, Somewhat Support, Neither Support nor Oppose, Somewhat Oppose, Strongly Oppose, and Don't Know. The model takes into account the following 5 predictor variables:
                              
1) Age is a continuous numeric variable representing the individual's age.
                                        
2) Gender is a binary variable (female/male) indicating a person's gender.
                                                
3) Education is a categorical variable representing the highest level of education a respondent had at the time of taking the survey. Categories include Graduated from college/CEGEP/Trade School, Graduated high school, Primary school or less, Some college/CEGEP/Trade School, Some high school, Some university but did not finish, University graduate degree, and University undergraduate degree.
                                               
4) Household income is a categorical variable indicating the respondent's household income range. Categories encompass different income ranges and a "Prefer not to answer" option.
                                                     
5) Location is a categorical variable representing the respondent's location within the City of Toronto. Categories include Toronto, East York, Etobicoke, North York, Scarborough, and York.

# Results
                                          
```{r}
#| message: false
#| warning: false
#| echo: false
#| tbl-cap: "Number and Proportion of people opinion on a by-request / ask first bylaw to reduce the use of single-use eating utensils in the City of Toronto"
#| label: tbl-number

# generate count and percentage
result_table <- raw_data %>%
  group_by(`single_use_utensil_bylaw_opinion`) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  as.data.frame()

# change the value "Don?t know" to "Don't know"
result_table$single_use_utensil_bylaw_opinion <- ifelse(result_table$single_use_utensil_bylaw_opinion == "Don?t know", "Don't know", result_table$single_use_utensil_bylaw_opinion)

# print the table
kable(result_table)
```
                              
@tbl-number presented summarizes the choices made by respondents regarding single-use takeaway items. The results indicate that 47.6% of respondents showed strong support for a by-request/ask-first bylaw to reduce the use of single-use eating utensils in the City of Toronto. Additionally, 27.9% of respondents somewhat supported the bylaw, while 11.4% of them neither supported nor opposed it. However, 6.2% of respondents somewhat opposed the bylaw, and 4.5% strongly opposed it. These findings suggest that while there is a significant level of support for the bylaw, there are still some concerns or reservations that need to be addressed.

Overall, the analysis suggests that there is mixed support for the single-use utensil bylaw, with a slight majority of respondents showing strong support for it. It is interesting to note that a significant percentage of respondents are still on the fence, as they neither support nor oppose the bylaw. This could indicate a lack of awareness or understanding of the issues surrounding single-use utensils and their impact on the environment.



```{r, include=FALSE}
# apply multinomial logistic regression model
model1 <- multinom(single_use_utensil_bylaw_opinion ~ age + gender + education + household_income + location, data = raw_data)

# extract the Residual Deviance and AIC values from the summary table
deviance <- round(model1$deviance, 3)
AIC <- round(AIC(model1), 3)

# Create a data frame with the Residual Deviance and AIC values
summary_data <- data.frame(`Residual Deviance` = deviance, `AIC` = AIC)

```

```{r}
#| message: false
#| warning: false
#| echo: false
#| tbl-cap: "Model Evaluation Metrics: Residual Deviance and Akaike Information Criterion (AIC)"
#| label: tbl-variance
# print the data
kable(t(summary_data), col.names = NULL, align = "c")
```

@tbl-variance shows that the logistic regression model has a statistically significant fit, as demonstrated by the significant difference between the null and residual deviance values. This suggests that the model has captured important information about the relationship between the predictors and the response variable. Furthermore, the AIC value of 2855.234 indicates that the model has some degree of complexity, but still performs reasonably well in terms of goodness-of-fit. These findings suggest that the model is a viable predictor of individual opinions towards a single-use utensil bylaw, based on their age, gender, education, household income, and location.

# Reference
